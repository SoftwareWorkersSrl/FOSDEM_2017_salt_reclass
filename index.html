<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>External node classifier for easy configuration management</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="author" content="Riccardo Scartozzi &lt;risca&gt;"></meta><meta name="description" content="Analysis on advantages of using an external node classifier system. Examples on how to ease Saltstack with reclass"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/asciinema-player.css" media="all"></link><link rel="stylesheet" href="css/impress-demo.css" media="all"></link><link rel="stylesheet" href="css/fonts.css" media="all"></link></head><body class="impress-not-supported"><div id="impress" auto-console="true"><div class="step step-level-1" step="0" id="title" data-scale="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-x="0" data-y="0" data-z="0"><h1 id="external-node-classifier-for-easy-configuration-management">External node classifier for easy configuration management</h1><p><em>Analysis on advantages of using an external node classifier system.</em> <br />
<em>Examples on how to ease Saltstack with reclass.</em></p><p>(slides soon at <a href="http://softwareworkers.it/configuration_management">softwareworkers.it/configuration_management</a>)</p><table cellpadding="0" cellspacing="0"><tbody><tr><td><p>by: Riccardo Scartozzi &lt;risca&gt;</p></td><td><p>From: Software Workers srl</p></td></tr></tbody></table></div><div class="step step-level-1 slide" step="1" id="Which_CMS" data-x="2400" data-scale="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-y="0" data-z="0"><h1 id="a-horde-of-configuration-management-systems">A horde of Configuration Management Systems</h1><img src="images/logo_ansible.png" height="130px"></img><img src="images/logo_cfengine.jpg" height="130px"></img><img src="images/logo_chef.svg" height="130px"></img><img src="images/logo_puppet.png" height="130px"></img><img src="images/logo_salt.jpg" height="130px"></img><div class="line-block"><br></br>And many more...<br></br></div></div><div class="step step-level-1 slide" step="2" data-x="3500" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-y="0" data-z="0"><h1 id="what-cms-does">What CMS does</h1><img src="images/CMS_process.png" height="350px"></img><ul><li>scripts and formulas</li><li>parametrization</li><li>classification</li></ul></div><div class="step step-level-1 slide" step="3" data-x="3500" data-rotate-x="90" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-y="0" data-z="0"><h1 id="but-it-s-not-just-about-coding">But it's not just about coding!</h1><ul><li>parametrization: declaring the values of objects</li><li>classification: targeting and identifying objects</li></ul></div><div class="step step-level-1 slide" step="4" data-x="4600" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-y="0" data-z="0"><p>Here come the ENCs...</p><h1 id="choose-wisely">Choose wisely</h1><ul><li><a href="https://github.com/brontolinux/hENC">hENC</a></li><li><a href="https://github.com/ytoolshed/range">range</a></li><li><a href="http://reclass.pantsfullofunix.net/">reclass</a></li><li><a href="https://docs.puppet.com/hiera/">hiera</a></li><li><a href="https://github.com/conversis/varstack">varstack</a></li><li><a href="https://www.theforeman.org/">foreman</a></li><li><a href="http://cobbler.github.io/">cobbler</a></li></ul></div><div class="step step-level-1 slide" step="5" id="enctable" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="5700" data-y="0" data-z="0"><h1 id="what-fits-with">What fits with</h1><img src="images/fitting.jpg" height="130px"></img><table cellpadding="0" cellspacing="0"><thead><tr><th><p>software</p></th><th><p>saltstack</p></th><th><p>puppet</p></th><th><p>chef</p></th><th><p>ansible</p></th><th><p>CFEngine</p></th></tr></thead><tbody><tr><td><p>hENC</p></td><td></td><td></td><td></td><td></td><td><p>X</p></td></tr><tr><td><p>reclass</p></td><td><p>X</p></td><td></td><td></td><td><p>X</p></td><td></td></tr><tr><td><p>hiera</p></td><td><p>X</p></td><td><p>X</p></td><td></td><td></td><td></td></tr><tr><td><p>varstack</p></td><td><p>X</p></td><td></td><td></td><td></td><td></td></tr><tr><td><p>foreman</p></td><td><p>X</p></td><td><p>X</p></td><td><p>X</p></td><td><p>X</p></td><td></td></tr><tr><td><p>cobbler</p></td><td><p>X</p></td><td><p>X</p></td><td><p>X</p></td><td><p>X</p></td><td><p>X</p></td></tr></tbody></table></div><div class="step step-level-1 slide" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6800" data-y="0" data-z="0"><h1 id="where-the-enc-helps">where the ENC helps</h1><table cellpadding="0" cellspacing="0"><thead><tr><th><p>targeting</p></th><th><p>&lt;==&gt;</p></th><th><p>parametrization</p></th></tr></thead><tbody><tr><td><p><img src="images/targeting.png" alt="targpng" height="150px"></img></p></td><td></td><td><p><img src="images/listing.png" alt="listpng" height="150px"></img></p></td></tr></tbody></table></div><div class="step step-level-1" step="7" data-rotate-z="450" data-rotate-x="0" data-rotate-y="0" data-scale="1" data-x="7900" data-y="0" data-z="0"><h1 id="change-your-point-of-view">Change your point of view</h1><img src="images/upsidedown.jpg" height="250px"></img></div><div class="step step-level-1 slide" step="8" data-rotate-z="90" data-x="7900" data-y="1100" data-rotate-x="0" data-rotate-y="0" data-scale="1" data-z="0"><h1 id="what-s-next">What's next?</h1><ul><li>install and configure <a href="https://docs.saltstack.com/en/latest/">saltstack</a></li><li>install and configure <a href="http://reclass.pantsfullofunix.net/">reclass</a></li></ul><p>(by yourself)</p></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-x="7900" data-y="2200" data-z="0"><img src="images/hand.jpg"></img></div><div class="step step-level-1 slide" step="10" data-scale="2" data-y="4000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-x="7900" data-z="0"><h1 id="saltstack-lexicon">Saltstack lexicon</h1><ul><li><strong>module</strong></li><li><strong>state</strong></li><li><strong>formula</strong></li><li><strong>pillar</strong></li><li><strong>grain</strong></li></ul><p>...and...</p></div><div class="step step-level-1 slide" step="11" data-scale="1" data-y="5800" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-x="7900" data-z="0"><p>Other data type:</p><ul><li>mine</li><li>beacon</li><li>reactor</li></ul><p><br />
Actions:</p><ul><li>execute <strong>state</strong></li><li>run command</li><li>query data and parameters</li><li>virtualization management</li><li>orchestration</li></ul></div><div class="step step-level-1 slide" step="12" data-y="6900" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-x="7900" data-z="0"><h1 id="parametes-type">Parametes' type</h1><p>From saltstack taxonomy:</p><ul><li>grain: static attribute of the node (IP, RAM, CPU, OS...)</li><li><strong>pillar</strong>: property/variable arbitrarily assigned</li></ul></div><div class="step step-level-1" step="13" data-x="-1200" data-y="2400" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-z="0"><h1 id="id2">Saltstack</h1><p>A pluggable system for your needs.</p></div><div class="step step-level-1 slide" step="14" data-x="-100" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-y="2400" data-z="0"><h1 id="default-configuration-files">Default configuration files</h1><ul><li>/srv/salt/: targeting and states</li><li>/srv/pillars/: parametrization</li></ul><p>File taxonomy:</p><ul><li>top.sls</li><li>mystate/init.sls</li><li>mystate.sls</li></ul></div><div class="step step-level-1 slide" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-x="1000" data-y="2400" data-z="0"><h1 id="managing-users-with-salstack">Managing users with Salstack</h1><p><a href="https://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html">Write</a> your own formula (and publish for the community!)</p><p>OR</p><p>Get formulas from <a href="https://github.com/saltstack-formulas/users-formula">GitHub</a>.</p></div><div class="step step-level-1 slide" step="16" data-x="1000" data-y="3500" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-z="0"><p>First: add formula</p><pre class="highlight code yaml"><span class="l-Scalar-Plain">gitfs_remotes</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">git://github.com/Sjd-Risca/users-formula.git</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">root</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">users</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">mountpoint</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">salt://users</span></pre><p>Or copy it into <tt>/srv/salt/</tt> (the path of your master's <tt>file_roots:</tt>)</p></div><div class="step step-level-1 slide big" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-x="1000" data-y="4600" data-z="0"><p>Second: target the nodes</p><asciinema-player src="shell/top.json" font-size="medium" ></asciinema-player></div><div class="step step-level-1 slide big" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-x="1000" data-y="5700" data-z="0"><p>Third: assign the parameters</p><asciinema-player src="shell/pillar.json" font-size="medium" ></asciinema-player><p>Help yourself with the formula's <a href="https://raw.githubusercontent.com/saltstack-formulas/users-formula/master/pillar.example">example</a>!</p></div><div class="step step-level-1 slide" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-x="1000" data-y="6800" data-z="0"><h1 id="scaling">Scaling</h1><p>Some example to think about:</p><ul><li>new server, same targeting</li><li>new server, but different targeting for pillars and/or for states</li><li>new server, with exception</li></ul><p>Also with saltstack is not possible to parametrize by pillar the pillars themselves.</p></div><div class="step step-level-1 slide" step="20" data-x="2000" data-y="2000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-z="0"><h1 id="id3">Reclass</h1><p><strong>R</strong> ecursive <strong>e</strong> xternal node <strong>class</strong> ifier</p></div><div class="step step-level-1 slide" step="21" data-x="2000" data-y="3100" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-z="0"><h1 id="reclass-data-structure">Reclass data structure</h1><p>The configuration path is split into:</p><ul><li>nodes: each file identifies a minion</li><li>classes: abstract object for inheritance and interpolation</li></ul></div><div class="step step-level-1 slide" step="22" data-rotate-x="0" data-rotate-y="0" data-rotate-z="90" data-scale="1" data-x="2000" data-y="4200" data-z="0"><h1 id="reclass-components">Reclass components</h1><p>Every can have any of the following attributes:</p><ul><li>applications</li><li>parameters</li><li>environment</li><li><strong>classes</strong></li></ul></div><div class="step step-level-1 slide" step="23" data-scale="2" data-z="100" data-y="5700" data-x="2800" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0"><h1 id="but-the-r">But the R?</h1><p>Reclass let to recursively interpolate the classes, from one object to another.</p><p><br />
But is possible to interpolate also the parameters, like:</p><pre class="highlight code yaml"><span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">keys</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">trusted_dev</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AASKDJKDJJEJKD</span>
  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">ssh_key</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">${keys:trusted_dev}</span></pre></div><div class="step step-level-1 slide" step="24" data-scale="1" data-z="0" data-y="7200" data-x="2800" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0"><h1 id="managing-users-with-salstack-and-reclass">Managing users with Salstack and Reclass</h1><p>Continuing from the previous example now the formula is already installed.</p><p>Starting with reclass there is no more need of:</p><ul><li><tt>/srv/salt/top.sls</tt></li><li><tt>/srv/pillars/*</tt></li></ul><p>With reclass only the existing formulas are kept (<tt>/srv/salt/*</tt>).</p></div><div class="step step-level-1 slide big" step="25" data-y="8000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="2800" data-z="0"><h1 id="node-creation">Node creation</h1><asciinema-player src="shell/node_creation.json" font-size="medium" ></asciinema-player></div><div class="step step-level-1 slide big" step="26" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="2800" data-y="8800" data-z="0"><h1 id="have-fun-with-classes">Have fun with classes</h1><asciinema-player src="shell/class_creation.json" font-size="medium" ></asciinema-player></div><div class="step step-level-1 slide big" step="27" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="2800" data-y="9600" data-z="0"><h1 id="more-classes">More classes</h1><asciinema-player src="shell/moreclass.json" font-size="medium" ></asciinema-player></div><div class="step step-level-1" step="28" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="2800" data-y="10400" data-z="0"><asciinema-player src="shell/param_inter.json" font-size="medium"></asciinema-player></div><div class="step step-level-1 slide" step="29" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="2800" data-y="11200" data-z="0"><h1 id="fun-with-interpolation">Fun with interpolation</h1><pre class="highlight code yaml"><span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">ssh_config</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">github</span><span class="p-Indicator">:</span> <span class="nv">*id001</span></pre><pre class="highlight code yaml"><span class="l-Scalar-Plain">sshconfig</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">github</span><span class="p-Indicator">:</span> <span class="nl">&amp;id001</span>
    <span class="l-Scalar-Plain">hostname</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">github</span>
    <span class="l-Scalar-Plain">options</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">HostName github.com</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">User git</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">IdentityFile ~/.ssh/id_rsa</span></pre></div><div class="step step-level-1 slide big" step="30" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="2800" data-y="12000" data-z="0"><h1 id="targeting-minions">Targeting minions</h1><asciinema-player src="shell/newnode.json" font-size="medium"></asciinema-player></div><div class="step step-level-1" step="31" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="2800" data-y="12800" data-z="0"><h1 id="question-time">Question time</h1><blockquote><p>So Long, and Thanks for All the Fish</p></blockquote></div><div class="step step-level-1" step="32" id="overview" data-x="3000" data-y="5000" data-z="500" data-scale="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0"></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script><script type="text/javascript" src="js/asciinema-player.js"></script></body></html>